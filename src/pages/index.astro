---
import { getCollection } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import SiteNav from '../components/SiteNav.astro';
import { BrowserDetectionBanner } from '../components/BrowserDetectionBanner';
import '../styles/global.css';

const siteTitle = 'contenteditable lab';
const cases = await getCollection('cases', ({ data }) => data.locale === 'en');
const scenarios = await getCollection('scenarios', ({ data }) => data.locale === 'en');

// Create a map of scenario ID to scenario entry for quick lookup
const scenarioMap = new Map(scenarios.map((s) => [s.data.id, s]));

const scenariosMap = cases.reduce(
  (acc, entry) => {
    const key = entry.data.scenarioId;
    if (!acc[key]) {
      acc[key] = {
        scenarioId: key,
        representative: entry,
        scenarioEntry: scenarioMap.get(key) || null,
      };
    } else if (entry.data.id > acc[key].representative.data.id) {
      acc[key].representative = entry;
    }
    return acc;
  },
  {} as Record<
    string,
    {
      scenarioId: string;
      representative: (typeof cases)[number];
      scenarioEntry: (typeof scenarios)[number] | null;
    }
  >,
);

const latestScenarios = Object.values(scenariosMap)
  .sort((a, b) => b.representative.data.id.localeCompare(a.representative.data.id))
  .slice(0, 20);

// Statistics
const totalCases = cases.length;
const totalScenarios = Object.keys(scenariosMap).length;
const osList = Array.from(new Set(cases.map((c) => c.data.os))).sort();
const browserList = Array.from(new Set(cases.map((c) => c.data.browser))).sort();
const confirmedCases = cases.filter((c) => c.data.status === 'confirmed').length;
const draftCases = cases.filter((c) => c.data.status === 'draft').length;

// Category statistics
const imeCases = cases.filter((c) => c.data.tags.some((tag) => tag.toLowerCase().includes('ime') || tag.toLowerCase().includes('composition'))).length;
const formattingCases = cases.filter((c) => c.data.tags.some((tag) => tag.toLowerCase().includes('formatting') || tag.toLowerCase().includes('bold') || tag.toLowerCase().includes('italic'))).length;
const selectionCases = cases.filter((c) => c.data.tags.some((tag) => tag.toLowerCase().includes('selection') || tag.toLowerCase().includes('caret'))).length;
const pasteCases = cases.filter((c) => c.data.tags.some((tag) => tag.toLowerCase().includes('paste') || tag.toLowerCase().includes('clipboard'))).length;

// Scenarios by category
const scenariosByCategory = scenarios.reduce((acc, s) => {
  const category = s.data.category || 'other';
  if (!acc[category]) acc[category] = [];
  acc[category].push(s);
  return acc;
}, {} as Record<string, typeof scenarios>);

// Recently added cases (sorted by ID, assuming higher ID = newer)
const recentlyAddedCases = [...cases]
  .sort((a, b) => b.data.id.localeCompare(a.data.id))
  .slice(0, 6);

// Recently added scenarios (new scenarios that have been added)
const recentlyAddedScenarios = scenarios
  .sort((a, b) => {
    // Try to find the latest case for each scenario
    const aCases = cases.filter((c) => c.data.scenarioId === a.data.id);
    const bCases = cases.filter((c) => c.data.scenarioId === b.data.id);
    if (aCases.length === 0 && bCases.length === 0) return 0;
    if (aCases.length === 0) return 1;
    if (bCases.length === 0) return -1;
    const aLatest = aCases.sort((x, y) => y.data.id.localeCompare(x.data.id))[0];
    const bLatest = bCases.sort((x, y) => y.data.id.localeCompare(x.data.id))[0];
    return bLatest.data.id.localeCompare(aLatest.data.id);
  })
  .slice(0, 3);
---

<html lang="en">
  <head>
    <BaseHead title={siteTitle} />
  </head>
  <body>
    <SiteNav />
    <BrowserDetectionBanner client:load />
    <main class="max-w-[1280px] mx-auto px-8 py-8 pb-12">
      <!-- Hero Section -->
      <section data-ui="hero" class="text-center py-16 px-4 mb-10 rounded-[24px] border border-border-light relative overflow-hidden" style="background: var(--hero-gradient);">
        <div class="relative z-10">
          <div class="inline-flex items-center gap-2 px-3.5 py-1.5 bg-bg-surface/90 backdrop-blur-sm border border-border-light rounded-full text-xs text-text-secondary mb-5 shadow-sm">
            <span class="text-base">üìù</span>
            <span>Real-world contenteditable research</span>
          </div>
          <h1 class="text-6xl font-extrabold m-0 mb-4 font-mono tracking-tight">
            contenteditable<span class="text-accent-primary">.</span>lab
          </h1>
          <p class="text-xl text-text-secondary max-w-[700px] mx-auto mb-8 leading-relaxed">
            Ever wondered why your contenteditable behaves differently in Safari vs Chrome? 
            Or why IME composition (Chinese, Japanese, Korean, and more) breaks in some browsers? 
            We're documenting these real-world quirks across all languages and input methods 
            so you don't have to discover them the hard way.
          </p>
          <div class="flex gap-3 justify-center flex-wrap mb-6">
            <a href="/cases" class="inline-flex items-center gap-2 px-7 py-3.5 bg-accent-primary text-white rounded-lg font-semibold text-base transition-all hover:bg-accent-primary-hover hover:text-white hover:-translate-y-0.5 hover:shadow-xl no-underline">
              Browse all cases
              <span>‚Üí</span>
            </a>
            <a href="/playground" class="inline-flex items-center px-7 py-3.5 bg-bg-surface text-text-primary border border-border-medium rounded-lg font-medium text-base transition-all hover:border-accent-primary hover:bg-bg-muted hover:text-accent-primary hover:shadow-md no-underline">
              Open playground
            </a>
          </div>
          <div class="flex items-center justify-center gap-6 text-sm text-text-muted">
            <div class="flex items-center gap-1.5">
              <span class="text-base">‚úì</span>
              <span>{totalCases} documented cases</span>
            </div>
            <div class="flex items-center gap-1.5">
              <span class="text-base">üåç</span>
              <span>All languages & IMEs</span>
            </div>
            <div class="flex items-center gap-1.5">
              <span class="text-base">üî¨</span>
              <span>Real-world tested</span>
            </div>
          </div>
        </div>
      </section>

      <!-- What's New Section -->
      {(recentlyAddedCases.length > 0 || recentlyAddedScenarios.length > 0) && (
        <section data-ui="whats-new" class="bg-gradient-to-br from-accent-primary/5 to-accent-secondary/5 border border-border-light rounded-2xl p-6 mb-8">
          <div class="flex items-center gap-3 mb-5">
            <div class="text-2xl">‚ú®</div>
            <div>
              <h2 class="text-lg m-0 mb-0.5 font-semibold">What's New</h2>
              <p class="text-sm text-text-muted m-0">Fresh cases and scenarios added recently</p>
            </div>
          </div>

          {recentlyAddedScenarios.length > 0 && (
            <div class="mb-4">
              <h3 class="text-sm font-semibold text-text-primary mb-2">New Scenarios</h3>
              <div class="flex flex-wrap gap-2">
                {recentlyAddedScenarios.map((scenario) => {
                  const scenarioCases = cases.filter((c) => c.data.scenarioId === scenario.data.id);
                  return (
                    <a
                      href={`/scenarios/${encodeURIComponent(scenario.data.id)}`}
                      class="inline-flex items-center gap-2 px-3 py-1.5 bg-bg-surface border border-border-light rounded-lg text-xs font-medium hover:border-accent-primary hover:bg-bg-muted transition-colors no-underline"
                    >
                      <span class="text-accent-primary">üìã</span>
                      <span class="text-text-primary">{scenario.data.title}</span>
                      <span class="text-text-muted">({scenarioCases.length})</span>
                    </a>
                  );
                })}
              </div>
            </div>
          )}

          {recentlyAddedCases.length > 0 && (
            <div>
              <h3 class="text-sm font-semibold text-text-primary mb-2">Latest Cases</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                {recentlyAddedCases.map((entry) => (
                  <a
                    href={`/cases/${entry.slug}`}
                    class="block p-3 bg-bg-surface border border-border-light rounded-lg hover:border-accent-primary hover:bg-bg-muted transition-colors no-underline"
                  >
                    <div class="flex items-start justify-between gap-2 mb-1.5">
                      <span class="text-xs font-mono text-text-muted">{entry.data.id}</span>
                      <span
                        class={`text-xs px-1.5 py-0.5 rounded ${
                          entry.data.status === 'confirmed'
                            ? 'bg-status-confirmed/20 text-status-confirmed'
                            : 'bg-status-draft/20 text-status-draft'
                        }`}
                      >
                        {entry.data.status}
                      </span>
                    </div>
                    <h4 class="text-sm font-medium text-text-primary m-0 mb-1 line-clamp-2">
                      {entry.data.caseTitle}
                    </h4>
                    <p class="text-xs text-text-muted m-0">
                      {entry.data.os} ¬∑ {entry.data.browser}
                    </p>
                  </a>
                ))}
              </div>
            </div>
          )}
        </section>
      )}

      <!-- Stats Grid -->
      <section data-ui="stats" class="mb-10">
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6">
          <div class="bg-bg-surface border border-border-light rounded-xl p-5 text-center transition-all hover:border-accent-primary hover:shadow-md">
            <div class="text-3xl font-bold leading-none text-accent-primary mb-1">{totalCases}</div>
            <div class="text-xs text-text-muted">Total Cases</div>
          </div>
          <div class="bg-bg-surface border border-border-light rounded-xl p-5 text-center transition-all hover:border-accent-primary hover:shadow-md">
            <div class="text-3xl font-bold leading-none mb-1" style="color: var(--category-ime);">{totalScenarios}</div>
            <div class="text-xs text-text-muted">Scenarios</div>
          </div>
          <div class="bg-bg-surface border border-border-light rounded-xl p-5 text-center transition-all hover:border-accent-primary hover:shadow-md">
            <div class="text-3xl font-bold leading-none mb-1" style="color: var(--category-formatting);">{osList.length}</div>
            <div class="text-xs text-text-muted">OS Variants</div>
          </div>
          <div class="bg-bg-surface border border-border-light rounded-xl p-5 text-center transition-all hover:border-accent-primary hover:shadow-md">
            <div class="text-3xl font-bold leading-none mb-1" style="color: var(--category-events);">{browserList.length}</div>
            <div class="text-xs text-text-muted">Browsers</div>
          </div>
          <div class="bg-bg-surface border border-border-light rounded-xl p-5 text-center transition-all hover:border-accent-primary hover:shadow-md">
            <div class="text-3xl font-bold leading-none mb-1" style="color: var(--status-confirmed);">{confirmedCases}</div>
            <div class="text-xs text-text-muted">Confirmed</div>
          </div>
          <div class="bg-bg-surface border border-border-light rounded-xl p-5 text-center transition-all hover:border-accent-primary hover:shadow-md">
            <div class="text-3xl font-bold leading-none mb-1" style="color: var(--status-draft);">{draftCases}</div>
            <div class="text-xs text-text-muted">Draft</div>
          </div>
        </div>
        
        <!-- Category Breakdown -->
        <div class="bg-gradient-to-br from-bg-muted/50 to-bg-surface border border-border-light rounded-xl p-5">
          <h3 class="text-sm font-semibold text-text-primary mb-3">Cases by Category</h3>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
            <div class="text-center">
              <div class="text-xl font-bold mb-0.5" style="color: var(--category-ime);">{imeCases}</div>
              <div class="text-xs text-text-muted">IME & Composition</div>
            </div>
            <div class="text-center">
              <div class="text-xl font-bold mb-0.5" style="color: var(--category-formatting);">{formattingCases}</div>
              <div class="text-xs text-text-muted">Formatting</div>
            </div>
            <div class="text-center">
              <div class="text-xl font-bold mb-0.5" style="color: var(--category-selection);">{selectionCases}</div>
              <div class="text-xs text-text-muted">Selection</div>
            </div>
            <div class="text-center">
              <div class="text-xl font-bold mb-0.5" style="color: var(--category-clipboard);">{pasteCases}</div>
              <div class="text-xs text-text-muted">Paste & Clipboard</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Browse by phenomenon -->
      <section data-ui="phenomenon" class="bg-bg-surface border border-border-light rounded-2xl p-6 mb-6">
        <div class="flex items-start gap-4 mb-5">
          <div class="text-3xl w-12 h-12 flex items-center justify-center bg-bg-muted rounded-xl flex-shrink-0">üî¨</div>
          <div>
            <h2 class="text-lg m-0 mb-1">Browse by phenomenon</h2>
            <p class="text-sm text-text-muted m-0">Start from a specific behavior or issue to see how it manifests across different environments. Each scenario tells a story of browser quirks and edge cases.</p>
          </div>
        </div>

        <div class="grid grid-cols-[repeat(auto-fit,minmax(240px,1fr))] gap-3 mb-4">
          {latestScenarios.slice(0, 6).map((item, idx) => {
            const scenarioTitle = item.scenarioEntry?.data.title || item.scenarioId;
            const scenarioCases = cases.filter((c) => c.data.scenarioId === item.scenarioId);
            const colors = [
              { bg: 'linear-gradient(135deg, #ede9fe, #fae8ff)', border: '#c4b5fd' },
              { bg: 'linear-gradient(135deg, #cffafe, #e0f2fe)', border: '#67e8f9' },
              { bg: 'linear-gradient(135deg, #fce7f3, #fce7f3)', border: '#f9a8d4' },
              { bg: 'linear-gradient(135deg, #ccfbf1, #d1fae5)', border: '#5eead4' },
              { bg: 'linear-gradient(135deg, #ffedd5, #fef3c7)', border: '#fdba74' },
              { bg: 'linear-gradient(135deg, #e0e7ff, #dbeafe)', border: '#a5b4fc' },
            ];
            const color = colors[idx % 6];
            return (
              <a
                href={`/scenarios/${encodeURIComponent(item.scenarioId)}`}
                class="block p-4 rounded-lg border transition-all hover:-translate-y-1 hover:shadow-xl no-underline group"
                style={`background: ${color.bg}; border-color: ${color.border};`}
              >
                <div class="text-sm font-semibold text-text-primary mb-1.5 line-clamp-2 group-hover:text-accent-primary transition-colors">{scenarioTitle}</div>
                <div class="text-xs text-text-muted mb-2 font-mono opacity-75">{item.scenarioId}</div>
                <div class="flex items-center justify-between">
                  <div class="text-xs text-text-muted">
                    {scenarioCases.length} case{scenarioCases.length === 1 ? '' : 's'}
                  </div>
                  <span class="text-xs text-text-muted group-hover:text-accent-primary transition-colors">‚Üí</span>
                </div>
              </a>
            );
          })}
        </div>
        <a href="/scenarios" class="inline-flex items-center mt-4 text-sm font-medium text-accent-primary hover:underline">
          View all scenarios ‚Üí
        </a>
      </section>

      <!-- Quick Links -->
      <section data-ui="quick-links" class="bg-bg-surface border border-border-light rounded-2xl p-6 mb-6">
        <div class="flex items-start gap-4 mb-5">
          <div class="text-3xl w-12 h-12 flex items-center justify-center bg-bg-muted rounded-xl flex-shrink-0">‚ö°</div>
          <div>
            <h2 class="text-lg m-0 mb-1">Quick Links</h2>
            <p class="text-sm text-text-muted m-0">Jump to popular sections and resources.</p>
          </div>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
          <a href="/cases" class="flex flex-col items-center gap-2 p-4 bg-bg-muted rounded-lg border border-border-light hover:border-accent-primary hover:bg-accent-primary/5 transition-all group no-underline">
            <span class="text-2xl">üìã</span>
            <span class="text-sm font-medium text-text-primary group-hover:text-accent-primary">All Cases</span>
            <span class="text-xs text-text-muted">{totalCases} cases</span>
          </a>
          <a href="/scenarios" class="flex flex-col items-center gap-2 p-4 bg-bg-muted rounded-lg border border-border-light hover:border-accent-primary hover:bg-accent-primary/5 transition-all group no-underline">
            <span class="text-2xl">üî¨</span>
            <span class="text-sm font-medium text-text-primary group-hover:text-accent-primary">Scenarios</span>
            <span class="text-xs text-text-muted">{totalScenarios} scenarios</span>
          </a>
          <a href="/playground" class="flex flex-col items-center gap-2 p-4 bg-bg-muted rounded-lg border border-border-light hover:border-accent-primary hover:bg-accent-primary/5 transition-all group no-underline">
            <span class="text-2xl">üß™</span>
            <span class="text-sm font-medium text-text-primary group-hover:text-accent-primary">Playground</span>
            <span class="text-xs text-text-muted">Test & explore</span>
          </a>
          <a href="/docs" class="flex flex-col items-center gap-2 p-4 bg-bg-muted rounded-lg border border-border-light hover:border-accent-primary hover:bg-accent-primary/5 transition-all group no-underline">
            <span class="text-2xl">üìö</span>
            <span class="text-sm font-medium text-text-primary group-hover:text-accent-primary">Documentation</span>
            <span class="text-xs text-text-muted">Guides & API</span>
          </a>
        </div>
      </section>

      <!-- Browse by category -->
      <section data-ui="category" class="bg-bg-surface border border-border-light rounded-2xl p-6 mb-6">
        <div class="flex items-start gap-4 mb-5">
          <div class="text-3xl w-12 h-12 flex items-center justify-center bg-bg-muted rounded-xl flex-shrink-0">üè∑Ô∏è</div>
          <div>
            <h2 class="text-lg m-0 mb-1">Browse by category</h2>
            <p class="text-sm text-text-muted m-0">Explore cases by topic tags or environment filters.</p>
          </div>
        </div>

        <div class="flex flex-wrap gap-2 mb-4">
          {(() => {
            const allTags = Array.from(
              new Set(cases.flatMap((c) => c.data.tags)),
            ).sort();
            const popularTags = allTags.filter((tag) => {
              const count = cases.filter((c) => c.data.tags.includes(tag)).length;
              return count >= 2;
            });

            const tagColors = {
              ime: '#8b5cf6',
              composition: '#8b5cf6',
              formatting: '#06b6d4',
              selection: '#ec4899',
              clipboard: '#14b8a6',
              events: '#f97316',
              dom: '#6366f1',
              css: '#84cc16',
              api: '#a855f7',
            };

            return (
              <>
                {popularTags.slice(0, 8).map((tag) => {
                  const color = tagColors[tag.toLowerCase()] || '#6b7280';
                  return (
                    <a
                      href={`/cases?tag=${encodeURIComponent(tag)}`}
                      class="px-3.5 py-1.5 rounded-full text-xs font-medium transition-all hover:scale-105 hover:shadow-md no-underline"
                      style={`background: color-mix(in srgb, ${color} 12%, white); color: ${color}; border: 1px solid color-mix(in srgb, ${color} 25%, transparent);`}
                      onmouseover={`this.style.boxShadow = '0 2px 8px color-mix(in srgb, ${color} 20%, transparent)'`}
                      onmouseout="this.style.boxShadow = ''"
                    >
                      {tag}
                    </a>
                  );
                })}
              </>
            );
          })()}
        </div>

        <div class="flex flex-wrap gap-2 mb-4">
          {(() => {
            const osData = Array.from(new Set(cases.map((c) => c.data.os))).sort();
            const browserData = Array.from(new Set(cases.map((c) => c.data.browser))).sort();

            return (
              <>
                {osData.slice(0, 3).map((os) => (
                  <a href={`/cases?q=${encodeURIComponent(os)}`} class="inline-flex items-center gap-1.5 px-3.5 py-1.5 rounded-lg text-xs font-medium bg-bg-muted text-text-secondary border border-border-light transition-all hover:bg-border-light hover:border-border-medium hover:text-text-primary no-underline">
                    <span class="text-sm">üíª</span>
                    {os}
                  </a>
                ))}
                {browserData.slice(0, 3).map((browser) => (
                  <a href={`/cases?q=${encodeURIComponent(browser)}`} class="inline-flex items-center gap-1.5 px-3.5 py-1.5 rounded-lg text-xs font-medium bg-bg-muted text-text-secondary border border-border-light transition-all hover:bg-border-light hover:border-border-medium hover:text-text-primary no-underline">
                    <span class="text-sm">üåê</span>
                    {browser}
                  </a>
                ))}
              </>
            );
          })()}
        </div>
        <a href="/cases" class="inline-flex items-center mt-4 text-sm font-medium text-accent-primary hover:underline">
          View all cases with filters ‚Üí
        </a>
      </section>

      <!-- Pinned incidents -->
      <section data-ui="pinned" class="bg-bg-surface border border-border-light rounded-2xl p-6 mb-6">
        <div class="flex items-start gap-4 mb-5">
          <div class="text-3xl w-12 h-12 flex items-center justify-center bg-bg-muted rounded-xl flex-shrink-0">üìå</div>
          <div>
            <h2 class="text-lg m-0 mb-1">Pinned incidents</h2>
            <p class="text-sm text-text-muted m-0">Curated baseline references and frequently observed issues.</p>
          </div>
        </div>

        <div class="grid grid-cols-[repeat(auto-fit,minmax(280px,1fr))] gap-4">
          {cases.filter((c) => c.data.tags.includes('baseline')).map((entry) => (
            <article class="p-4 px-4.5 bg-bg-surface border border-border-light rounded-lg transition-colors hover:border-accent-primary">
              <h3 class="text-[0.95rem] m-0 mb-1.5">{entry.data.caseTitle}</h3>
              <p class="text-xs text-text-muted m-0 mb-2">
                {entry.data.os} {entry.data.osVersion} ¬∑ {entry.data.browser} {entry.data.browserVersion}
              </p>
              <a href={`/cases/${entry.slug}`} class="text-xs font-medium text-accent-primary hover:underline no-underline">
                Open case ‚Üí
              </a>
            </article>
          ))}
        </div>
      </section>

      <!-- Community & Communication -->
      <section data-ui="community" class="bg-gradient-to-br from-accent-primary/5 via-accent-secondary/5 to-accent-primary/5 border border-border-light rounded-2xl p-6 mb-6">
        <div class="flex items-start gap-4 mb-5">
          <div class="text-3xl w-12 h-12 flex items-center justify-center bg-bg-muted rounded-xl flex-shrink-0">üí¨</div>
          <div>
            <h2 class="text-lg m-0 mb-1">Join the Community</h2>
            <p class="text-sm text-text-muted m-0">Share your findings, ask questions, or contribute to the project. Your input helps make this catalog more comprehensive.</p>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <a
            href="https://github.com/easylogic/contenteditable/discussions"
            target="_blank"
            rel="noopener noreferrer"
            class="flex flex-col gap-2 p-4 bg-bg-surface border border-border-light rounded-lg hover:border-accent-primary hover:shadow-md transition-all group no-underline"
          >
            <div class="text-2xl">üí≠</div>
            <h3 class="text-sm font-semibold text-text-primary m-0 group-hover:text-accent-primary transition-colors">Discussions</h3>
            <p class="text-xs text-text-muted m-0">Share ideas, ask questions, and discuss contenteditable behavior</p>
          </a>

          <a
            href="https://github.com/easylogic/contenteditable/issues"
            target="_blank"
            rel="noopener noreferrer"
            class="flex flex-col gap-2 p-4 bg-bg-surface border border-border-light rounded-lg hover:border-accent-primary hover:shadow-md transition-all group no-underline"
          >
            <div class="text-2xl">üêõ</div>
            <h3 class="text-sm font-semibold text-text-primary m-0 group-hover:text-accent-primary transition-colors">Report Issues</h3>
            <p class="text-xs text-text-muted m-0">Found a bug or have a feature request? Open an issue</p>
          </a>

          <a
            href="https://github.com/easylogic/contenteditable"
            target="_blank"
            rel="noopener noreferrer"
            class="flex flex-col gap-2 p-4 bg-bg-surface border border-border-light rounded-lg hover:border-accent-primary hover:shadow-md transition-all group no-underline"
          >
            <div class="text-2xl">‚≠ê</div>
            <h3 class="text-sm font-semibold text-text-primary m-0 group-hover:text-accent-primary transition-colors">Star on GitHub</h3>
            <p class="text-xs text-text-muted m-0">Show your support by starring the repository</p>
          </a>

          <a
            href="/CONTRIBUTING.md"
            class="flex flex-col gap-2 p-4 bg-bg-surface border border-border-light rounded-lg hover:border-accent-primary hover:shadow-md transition-all group no-underline"
          >
            <div class="text-2xl">ü§ù</div>
            <h3 class="text-sm font-semibold text-text-primary m-0 group-hover:text-accent-primary transition-colors">Contribute</h3>
            <p class="text-xs text-text-muted m-0">Learn how to add cases, improve docs, or help translate</p>
          </a>
        </div>
      </section>

      <!-- Latest scenarios -->
      <section data-ui="latest" class="bg-bg-surface border border-border-light rounded-2xl p-6">
        <div class="flex items-start gap-4 mb-5">
          <div class="text-3xl w-12 h-12 flex items-center justify-center bg-bg-muted rounded-xl flex-shrink-0">üÜï</div>
          <div>
            <h2 class="text-lg m-0 mb-1">Latest scenarios</h2>
            <p class="text-sm text-text-muted m-0">Recently documented scenarios, sorted by the most recent case added. Keep checking back for new discoveries!</p>
          </div>
        </div>

        <div class="grid grid-cols-[repeat(auto-fit,minmax(280px,1fr))] gap-4">
          {latestScenarios.map((item) => {
            const scenarioTitle = item.scenarioEntry?.data.title || item.representative.data.caseTitle;
            const scenarioCases = cases.filter((c) => c.data.scenarioId === item.scenarioId);
            return (
              <article class="p-4 bg-bg-surface border border-border-light rounded-lg transition-all hover:border-accent-primary hover:shadow-md group">
                <h3 class="text-sm m-0 mb-2 font-semibold text-text-primary line-clamp-2 group-hover:text-accent-primary transition-colors">{scenarioTitle}</h3>
                <p class="text-xs text-text-muted m-0 mb-2 font-mono opacity-75">
                  {item.scenarioId}
                </p>
                <div class="flex items-center justify-between mb-3">
                  <p class="text-xs text-text-muted m-0">
                    {scenarioCases.length} case{scenarioCases.length === 1 ? '' : 's'} ¬∑ {item.representative.data.os}
                  </p>
                </div>
                <div class="flex gap-3 text-xs">
                  <a href={`/scenarios/${encodeURIComponent(item.scenarioId)}`} class="font-medium text-accent-primary hover:underline no-underline flex items-center gap-1">
                    View scenario
                    <span>‚Üí</span>
                  </a>
                </div>
              </article>
            );
          })}
        </div>
      </section>
    </main>

    <footer data-ui="site-footer" class="border-t border-border-light bg-bg-surface mt-16">
      <div class="max-w-[1280px] mx-auto px-8 py-8">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
          <div>
            <a href="/" class="inline-flex items-center gap-2 mb-4 no-underline">
              <span class="text-xl">‚å®</span>
              <span class="font-mono font-bold text-text-primary">
                contenteditable<span class="text-accent-primary">.</span>lab
              </span>
            </a>
            <p class="text-sm text-text-muted m-0">
              Real-world contenteditable behavior research and documentation.
            </p>
          </div>
          
          <div>
            <h4 class="text-sm font-semibold text-text-primary m-0 mb-3">Explore</h4>
            <ul class="list-none p-0 m-0 space-y-2">
              <li><a href="/cases" class="text-sm text-text-secondary hover:text-accent-primary no-underline">All Cases</a></li>
              <li><a href="/scenarios" class="text-sm text-text-secondary hover:text-accent-primary no-underline">Scenarios</a></li>
              <li><a href="/playground" class="text-sm text-text-secondary hover:text-accent-primary no-underline">Playground</a></li>
              <li><a href="/coverage" class="text-sm text-text-secondary hover:text-accent-primary no-underline">Coverage</a></li>
            </ul>
          </div>
          
          <div>
            <h4 class="text-sm font-semibold text-text-primary m-0 mb-3">Resources</h4>
            <ul class="list-none p-0 m-0 space-y-2">
              <li><a href="/docs" class="text-sm text-text-secondary hover:text-accent-primary no-underline">Documentation</a></li>
              <li><a href="/docs/input-types" class="text-sm text-text-secondary hover:text-accent-primary no-underline">Input Types</a></li>
              <li><a href="/docs/iframe-integration" class="text-sm text-text-secondary hover:text-accent-primary no-underline">Iframe Integration</a></li>
            </ul>
          </div>
          
          <div>
            <h4 class="text-sm font-semibold text-text-primary m-0 mb-3">About</h4>
            <p class="text-sm text-text-muted m-0 mb-2">
              An open catalog documenting contenteditable behavior across different browsers, operating systems, and input methods.
            </p>
          </div>
        </div>
        
        <div class="pt-6 border-t border-border-light flex flex-col md:flex-row justify-between items-center gap-4">
          <p class="text-xs text-text-muted m-0">
            ¬© {new Date().getFullYear()} contenteditable.lab. Open source research project.
          </p>
          <div class="flex gap-4 text-xs text-text-muted">
            <a href="https://github.com/easylogic/contenteditable" target="_blank" rel="noopener noreferrer" class="hover:text-accent-primary no-underline">
              GitHub
            </a>
          </div>
        </div>
      </div>
    </footer>
  </body>
</html>

<style>
  /* Responsive adjustments */
  @media (max-width: 768px) {
    main {
      padding: 1rem;
    }

    [data-ui="hero"] {
      padding: 2rem 1rem;
    }

    [data-ui="hero"] h1 {
      font-size: 2rem;
    }

    [data-ui="stats"] {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (max-width: 480px) {
    [data-ui="stats"] {
      grid-template-columns: repeat(2, 1fr);
    }

    [data-ui="stats"] .text-3xl {
      font-size: 1.5rem;
    }
  }
</style>
