---
import { getCollection } from 'astro:content';
import SiteNav from '../../components/SiteNav.astro';
import DocsSidebar from '../../components/DocsSidebar.astro';
import BaseHead from '../../components/BaseHead.astro';
import '../../styles/global.css';

const allCases = await getCollection('cases');

// Build browser compatibility overview
const browsers = Array.from(new Set(allCases.map((c) => c.data.browser))).sort();
const osList = Array.from(new Set(allCases.map((c) => c.data.os))).sort();

const browserStats = browsers.map((browser) => {
  const browserCases = allCases.filter((c) => c.data.browser === browser);
  const osCoverage = osList.map((os) => {
    const osCases = browserCases.filter((c) => c.data.os === os);
    return {
      os,
      count: osCases.length,
      confirmed: osCases.filter((c) => c.data.status === 'confirmed').length,
    };
  });
  return {
    browser,
    totalCases: browserCases.length,
    confirmedCases: browserCases.filter((c) => c.data.status === 'confirmed').length,
    osCoverage,
  };
});
---

<html lang="en">
  <head>
    <BaseHead title="Browser compatibility – contenteditable.lab" description="Overview of contenteditable support across browsers." />
  </head>
  <body>
    <SiteNav />
    <main
      style="
        display: flex;
        max-width: 100%;
        margin: 0;
        padding: 0;
      "
    >
      <DocsSidebar currentPath={Astro.url.pathname} />

      <section
        style="
          flex: 1;
          max-width: 1120px;
          margin: 0 auto;
          padding: 1.75rem 1.25rem 2.5rem;
          width: 100%;
        "
      >
      <header style="margin-bottom: 2rem;">
        <nav style="margin-bottom: 1rem; font-size: 0.85rem;">
          <a href="/docs" style="color: var(--text-muted); text-decoration: none;">Documentation</a>
          <span style="color: var(--text-faint); margin: 0 0.5rem;">/</span>
          <span style="color: var(--text-primary);">Browser compatibility</span>
        </nav>
        <h1
          style="
            font-size: 2rem;
            line-height: 1.1;
            margin: 0 0 0.5rem 0;
          "
        >
          Browser compatibility
        </h1>
        <p style="margin: 0; font-size: 0.95rem; color: var(--text-secondary);">
          Overview of contenteditable support and behavior differences across browsers and operating systems.
        </p>
      </header>

      <article
        style="
          border-radius: 0.75rem;
          border: 1px solid var(--border-light);
          background: var(--bg-surface);
          padding: 1.5rem 1.75rem;
          font-size: 0.9rem;
          line-height: 1.7;
        "
      >
        <section style="margin-bottom: 2rem;">
          <h2
            style="
              font-size: 1.3rem;
              margin: 0 0 0.75rem 0;
              padding-bottom: 0.5rem;
              border-bottom: 2px solid var(--border-light);
            "
          >
            Browser support overview
          </h2>
          <p style="margin: 0 0 1rem 0;">
            The contenteditable attribute is widely supported, but behavior varies significantly across browsers. This table shows the number of documented cases per browser and OS combination.
          </p>
          <div style="overflow-x: auto; margin-bottom: 1rem;">
            <table
              style="
                width: 100%;
                border-collapse: collapse;
                font-size: 0.85rem;
              "
            >
              <thead>
                <tr>
                  <th
                    style="
                      text-align: left;
                      padding: 0.5rem 0.75rem;
                      border-bottom: 2px solid var(--border-light);
                      background: var(--bg-muted);
                      position: sticky;
                      left: 0;
                      z-index: 1;
                    "
                  >
                    Browser
                  </th>
                  {osList.map((os) => (
                    <th
                      style="
                        text-align: center;
                        padding: 0.5rem 0.75rem;
                        border-bottom: 2px solid var(--border-light);
                        background: var(--bg-muted);
                        font-weight: 600;
                      "
                    >
                      {os}
                    </th>
                  ))}
                  <th
                    style="
                      text-align: center;
                      padding: 0.5rem 0.75rem;
                      border-bottom: 2px solid var(--border-light);
                      background: var(--bg-muted);
                      font-weight: 600;
                    "
                  >
                    Total
                  </th>
                </tr>
              </thead>
              <tbody>
                {browserStats.map((stat) => (
                  <tr>
                    <td
                      style="
                        padding: 0.5rem 0.75rem;
                        border-bottom: 1px solid var(--border-light);
                        background: var(--bg-muted);
                        font-weight: 600;
                        position: sticky;
                        left: 0;
                        z-index: 1;
                      "
                    >
                      {stat.browser}
                    </td>
                    {stat.osCoverage.map((coverage) => (
                      <td
                        style="
                          padding: 0.5rem 0.75rem;
                          border-bottom: 1px solid var(--border-light);
                          text-align: center;
                        "
                      >
                        {coverage.count > 0 ? (
                          <div>
                            <div style="font-weight: 600; color: var(--text-primary);">
                              {coverage.count}
                            </div>
                            {coverage.confirmed > 0 && (
                              <div
                                style="
                                  font-size: 0.75rem;
                                  color: var(--status-confirmed);
                                  margin-top: 0.2rem;
                                "
                              >
                                {coverage.confirmed} confirmed
                              </div>
                            )}
                          </div>
                        ) : (
                          <span style="color: var(--text-faint);">—</span>
                        )}
                      </td>
                    ))}
                    <td
                      style="
                        padding: 0.5rem 0.75rem;
                        border-bottom: 1px solid var(--border-light);
                        text-align: center;
                        font-weight: 600;
                      "
                    >
                      {stat.totalCases}
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </section>

        <section style="margin-bottom: 2rem;">
          <h2
            style="
              font-size: 1.3rem;
              margin: 0 0 0.75rem 0;
              padding-bottom: 0.5rem;
              border-bottom: 2px solid var(--border-light);
            "
          >
            Known differences
          </h2>
          <div style="margin-bottom: 1.5rem;">
            <h3
              style="
                font-size: 1.1rem;
                margin: 0 0 0.5rem 0;
                color: var(--text-primary);
              "
            >
              Safari
            </h3>
            <ul style="margin: 0; padding-left: 1.5rem;">
              <li style="margin-bottom: 0.5rem;">
                Does not support the <code style="background: var(--bg-muted); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.85em;">beforeinput</code> event
              </li>
              <li style="margin-bottom: 0.5rem;">
                May insert double line breaks when pressing Enter
              </li>
              <li style="margin-bottom: 0.5rem;">
                Formatting persistence issues (bold, italic, etc.)
              </li>
            </ul>
          </div>

          <div style="margin-bottom: 1.5rem;">
            <h3
              style="
                font-size: 1.1rem;
                margin: 0 0 0.5rem 0;
                color: var(--text-primary);
              "
            >
              Chrome
            </h3>
            <ul style="margin: 0; padding-left: 1.5rem;">
              <li style="margin-bottom: 0.5rem;">
                Shows deprecation warnings for <code style="background: var(--bg-muted); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.85em;">execCommand</code>
              </li>
              <li style="margin-bottom: 0.5rem;">
                IME composition behavior differs from Safari
              </li>
              <li style="margin-bottom: 0.5rem;">
                Better support for <code style="background: var(--bg-muted); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.85em;">beforeinput</code> event
              </li>
            </ul>
          </div>

          <div style="margin-bottom: 1.5rem;">
            <h3
              style="
                font-size: 1.1rem;
                margin: 0 0 0.5rem 0;
                color: var(--text-primary);
              "
            >
              Firefox
            </h3>
            <ul style="margin: 0; padding-left: 1.5rem;">
              <li style="margin-bottom: 0.5rem;">
                Different event order for IME composition
              </li>
              <li style="margin-bottom: 0.5rem;">
                Caret positioning issues after paste
              </li>
              <li style="margin-bottom: 0.5rem;">
                Selection behavior differences
              </li>
            </ul>
          </div>

          <div>
            <h3
              style="
                font-size: 1.1rem;
                margin: 0 0 0.5rem 0;
                color: var(--text-primary);
              "
            >
              Edge
            </h3>
            <ul style="margin: 0; padding-left: 1.5rem;">
              <li style="margin-bottom: 0.5rem;">
                Based on Chromium, but may have Edge-specific behaviors
              </li>
              <li style="margin-bottom: 0.5rem;">
                Input event duplication issues
              </li>
            </ul>
          </div>
        </section>

        <section>
          <h2
            style="
              font-size: 1.3rem;
              margin: 0 0 0.75rem 0;
              padding-bottom: 0.5rem;
              border-bottom: 2px solid var(--border-light);
            "
          >
            Related resources
          </h2>
          <ul style="margin: 0; padding-left: 1.5rem;">
            <li style="margin-bottom: 0.5rem;">
              <a
                href="/scenarios"
                style="color: var(--accent-primary); text-decoration: none;"
              >
                Browse all scenarios →
              </a>
            </li>
            <li style="margin-bottom: 0.5rem;">
              <a
                href="/cases"
                style="color: var(--accent-primary); text-decoration: none;"
              >
                Browse all cases →
              </a>
            </li>
          </ul>
        </section>
      </article>
      </section>
    </main>
  </body>
</html>

