---
import DocLayout from '../../components/docs/DocLayout.astro';
import DocSection from '../../components/docs/DocSection.astro';
import DocCodeBlock from '../../components/docs/DocCodeBlock.astro';
import DocInfoBox from '../../components/docs/DocInfoBox.astro';
import DocAlert from '../../components/docs/DocAlert.astro';
import TableOfContents from '../../components/TableOfContents.astro';
import '../../styles/global.css';

// Define headings for TOC
const headings = [
  { depth: 2, slug: 'event-order', text: 'Event order' },
  { depth: 2, slug: 'key-events', text: 'Key events' },
  { depth: 3, slug: 'beforeinput', text: 'beforeinput' },
  { depth: 3, slug: 'input', text: 'input' },
  { depth: 3, slug: 'composition-events', text: 'Composition events' },
  { depth: 2, slug: 'browser-differences', text: 'Browser differences' },
  { depth: 2, slug: 'related-resources', text: 'Related resources' },
];

const beforeInputCode = `element.addEventListener('beforeinput', (e) => {
  if (e.inputType === 'insertText') {
    // Modify or prevent the input
    e.preventDefault();
  }
});`;

const inputCode = `element.addEventListener('input', (e) => {
  // DOM has already been updated
  console.log(element.innerHTML);
});`;

const compositionCode = `element.addEventListener('compositionstart', (e) => {
  // IME composition started
});

element.addEventListener('compositionupdate', (e) => {
  // Composition in progress
  console.log(e.data); // Current composition text
});

element.addEventListener('compositionend', (e) => {
  // Composition completed
});`;
---

<DocLayout
  title="Events in contenteditable"
  description="Understanding the event lifecycle when users interact with contenteditable elements."
  currentPath={Astro.url.pathname}
>
        <DocSection id="event-order" title="Event order">
          <p class="m-0 mb-4">
            When a user types in a contenteditable element, events fire in a specific order. The exact order can vary by browser and input method.
          </p>
          <DocInfoBox>
            <ol class="m-0 pl-6">
              <li class="mb-2">
                <code class="bg-bg-muted px-1.5 py-0.5 rounded text-[0.85em]">keydown</code> – Fires when a key is pressed
              </li>
              <li class="mb-2">
                <code class="bg-bg-muted px-1.5 py-0.5 rounded text-[0.85em]">beforeinput</code> – Fires before input is committed
              </li>
              <li class="mb-2">
                <code class="bg-bg-muted px-1.5 py-0.5 rounded text-[0.85em]">compositionstart</code> – Fires when IME composition begins
              </li>
              <li class="mb-2">
                <code class="bg-bg-muted px-1.5 py-0.5 rounded text-[0.85em]">compositionupdate</code> – Fires during IME composition (may fire multiple times)
              </li>
              <li class="mb-2">
                <code class="bg-bg-muted px-1.5 py-0.5 rounded text-[0.85em]">compositionend</code> – Fires when IME composition completes
              </li>
              <li class="mb-2">
                <code class="bg-bg-muted px-1.5 py-0.5 rounded text-[0.85em]">input</code> – Fires after the DOM has been updated
              </li>
            </ol>
          </DocInfoBox>
        </DocSection>

        <DocSection id="key-events" title="Key events">
          <div class="mb-6">
            <h3 id="beforeinput" class="text-lg m-0 mb-2 text-text-primary">
              beforeinput
            </h3>
            <p class="m-0 mb-2">
              Fires before input is committed to the DOM. Allows you to prevent or modify the default behavior. Browser support varies by version.
            </p>
            <DocCodeBlock code={beforeInputCode} />
          </div>

          <div class="mb-6">
            <h3 id="input" class="text-lg m-0 mb-2 text-text-primary">
              input
            </h3>
            <p class="m-0 mb-2">
              Fires after the DOM has been updated with the new content. This is the most reliable event for detecting changes, but you cannot prevent the change at this point.
            </p>
            <DocCodeBlock code={inputCode} />
          </div>

          <div class="mb-6">
            <h3 id="composition-events" class="text-lg m-0 mb-2 text-text-primary">
              Composition events
            </h3>
            <p class="m-0 mb-2">
              Fired when using Input Method Editors (IME) for languages like Japanese, Korean, or Chinese. These events allow you to track the composition process.
            </p>
            <DocCodeBlock code={compositionCode} />
          </div>
        </DocSection>

        <DocSection id="browser-differences" title="Browser differences">
          <DocAlert type="warning" class="mb-4">
            <p class="m-0 text-sm">
              <strong>Event order varies:</strong> The exact order and timing of events differs between browsers, especially for IME composition and special keys (Enter, Backspace, etc.).
            </p>
          </DocAlert>
          <DocAlert type="warning" class="mb-4">
            <p class="m-0 text-sm">
              <strong>beforeinput support:</strong> Browser support for <code class="bg-bg-muted px-1.5 py-0.5 rounded text-[0.85em]">beforeinput</code> varies by version. Some older browsers may not support it. Always test in your target browsers and consider <code class="bg-bg-muted px-1.5 py-0.5 rounded text-[0.85em]">keydown</code> or <code class="bg-bg-muted px-1.5 py-0.5 rounded text-[0.85em]">input</code> as fallbacks.
            </p>
          </DocAlert>
          <DocAlert type="warning">
            <p class="m-0 text-sm">
              <strong>Event duplication:</strong> Some browsers may fire events multiple times for a single user action. Always test your event handlers across different browsers.
            </p>
          </DocAlert>
        </DocSection>

        <DocSection id="related-resources" title="Related resources">
          <ul class="m-0 pl-6">
            <li class="mb-2">
              <a href="/docs/input-types" class="text-accent-primary no-underline">
                Input Types & Formatting Events →
              </a>
            </li>
            <li class="mb-2">
              <a href="/docs/ime-composition" class="text-accent-primary no-underline">
                IME & Composition →
              </a>
            </li>
            <li class="mb-2">
              <a href="/cases?tag=events" class="text-accent-primary no-underline">
                Browse cases related to events →
              </a>
            </li>
            <li class="mb-2">
              <a href="/playground" class="text-accent-primary no-underline">
                Test events in the playground →
              </a>
            </li>
          </ul>
        </DocSection>
</DocLayout>

<div class="flex-1 flex max-w-[1120px] mx-auto py-7 px-5 pb-10 gap-6">
  <div class="flex-1"></div>
  <TableOfContents headings={headings} />
</div>

