---
import SiteNav from '../../components/SiteNav.astro';
import DocsSidebar from '../../components/DocsSidebar.astro';
import BaseHead from '../../components/BaseHead.astro';
import '../../styles/global.css';

const getSelectionCode = `const selection = window.getSelection();

if (selection && selection.rangeCount > 0) {
  const range = selection.getRangeAt(0);
  console.log('Selected text:', range.toString());
  console.log('Start:', range.startOffset);
  console.log('End:', range.endOffset);
}`;

const rangeCode = `// Create a new range
const range = document.createRange();

// Set the range to cover specific content
range.setStart(element.firstChild, 5);
range.setEnd(element.firstChild, 10);

// Apply the range to the selection
const selection = window.getSelection();
selection.removeAllRanges();
selection.addRange(range);`;

const nodeSelectionCode = `// Select an entire node (e.g., an image or div)
const range = document.createRange();
range.selectNode(element); // Selects the entire element node

// Or select the contents of a node
range.selectNodeContents(element); // Selects all children, but not the element itself

// Apply to selection
const selection = window.getSelection();
selection.removeAllRanges();
selection.addRange(range);`;
---

<html lang="en">
  <head>
    <BaseHead title="Selection API – contenteditable.lab" description="Working with text selection, ranges, and the Selection API." />
  </head>
  <body>
    <SiteNav />
    <main
      style="
        display: flex;
        max-width: 100%;
        margin: 0;
        padding: 0;
      "
    >
      <DocsSidebar currentPath={Astro.url.pathname} />

      <section
        style="
          flex: 1;
          max-width: 1120px;
          margin: 0 auto;
          padding: 1.75rem 1.25rem 2.5rem;
          width: 100%;
        "
      >
      <header style="margin-bottom: 2rem;">
        <nav style="margin-bottom: 1rem; font-size: 0.85rem;">
          <a href="/docs" style="color: var(--text-muted); text-decoration: none;">Documentation</a>
          <span style="color: var(--text-faint); margin: 0 0.5rem;">/</span>
          <span style="color: var(--text-primary);">Selection API</span>
        </nav>
        <h1
          style="
            font-size: 2rem;
            line-height: 1.1;
            margin: 0 0 0.5rem 0;
          "
        >
          Selection API
        </h1>
        <p style="margin: 0; font-size: 0.95rem; color: var(--text-secondary);">
          Working with text selection, ranges, and the Selection API in contenteditable elements.
        </p>
      </header>

      <article
        style="
          border-radius: 0.75rem;
          border: 1px solid var(--border-light);
          background: var(--bg-surface);
          padding: 1.5rem 1.75rem;
          font-size: 0.9rem;
          line-height: 1.7;
        "
      >
        <section style="margin-bottom: 2rem;">
          <h2
            style="
              font-size: 1.3rem;
              margin: 0 0 0.75rem 0;
              padding-bottom: 0.5rem;
              border-bottom: 2px solid var(--border-light);
            "
          >
            Getting the selection
          </h2>
          <p style="margin: 0 0 1rem 0;">
            The <code style="background: var(--bg-muted); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.85em;">window.getSelection()</code> method returns a Selection object representing the current text selection.
          </p>
          <pre
            style="
              background: var(--bg-muted);
              border: 1px solid var(--border-light);
              border-radius: 0.5rem;
              padding: 1rem;
              overflow-x: auto;
              font-size: 0.85rem;
              line-height: 1.6;
              color: var(--text-primary);
            "
          ><code>{getSelectionCode}</code></pre>
        </section>

        <section style="margin-bottom: 2rem;">
          <h2
            style="
              font-size: 1.3rem;
              margin: 0 0 0.75rem 0;
              padding-bottom: 0.5rem;
              border-bottom: 2px solid var(--border-light);
            "
          >
            Range API
          </h2>
          <p style="margin: 0 0 1rem 0;">
            A Range represents a contiguous portion of the document. You can create, modify, and manipulate ranges programmatically.
          </p>
          <pre
            style="
              background: var(--bg-muted);
              border: 1px solid var(--border-light);
              border-radius: 0.5rem;
              padding: 1rem;
              overflow-x: auto;
              font-size: 0.85rem;
              line-height: 1.6;
              color: var(--text-primary);
            "
          ><code>{rangeCode}</code></pre>
        </section>

        <section style="margin-bottom: 2rem;">
          <h2
            style="
              font-size: 1.3rem;
              margin: 0 0 0.75rem 0;
              padding-bottom: 0.5rem;
              border-bottom: 2px solid var(--border-light);
            "
          >
            Node Selection
          </h2>
          <p style="margin: 0 0 1rem 0;">
            Unlike text selection, which selects characters within text nodes, <strong>node selection</strong> selects entire element nodes (like images, divs, or other HTML elements). This is useful when you want to select non-text content or entire blocks of content.
          </p>

          <div style="margin: 1.5rem 0; padding: 1.5rem; background: var(--bg-muted); border-radius: 0.5rem; border: 1px solid var(--border-light);">
            <h3 style="font-size: 1rem; margin: 0 0 1rem 0; color: var(--text-primary);">
              Text Selection vs Node Selection
            </h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1rem;">
              <!-- Text Selection -->
              <div style="background: var(--bg-surface); padding: 1rem; border-radius: 0.375rem; border: 1px solid var(--border-light);">
                <h4 style="font-size: 0.9rem; margin: 0 0 0.75rem 0; color: var(--text-primary); font-weight: 600;">
                  Text Selection
                </h4>
                <div style="font-size: 0.85rem; line-height: 1.6; color: var(--text-secondary); margin-bottom: 0.75rem;">
                  <p style="margin: 0; padding: 0.5rem; background: var(--bg-page); border-radius: 0.25rem; border: 1px solid var(--border-light);">
                    This is a <span style="background: rgba(66, 133, 244, 0.3); padding: 0 2px; border-radius: 2px;">paragraph</span> with text.
                  </p>
                </div>
                <div style="font-size: 0.75rem; color: var(--text-muted);">
                  <div><strong>Container:</strong> #text node</div>
                  <div><strong>Offset:</strong> Character position (0, 1, 2...)</div>
                  <div><strong>Example:</strong> startOffset: 10, endOffset: 19</div>
                </div>
              </div>

              <!-- Node Selection -->
              <div style="background: var(--bg-surface); padding: 1rem; border-radius: 0.375rem; border: 1px solid var(--border-light);">
                <h4 style="font-size: 0.9rem; margin: 0 0 0.75rem 0; color: var(--text-primary); font-weight: 600;">
                  Node Selection
                </h4>
                <div style="font-size: 0.85rem; line-height: 1.6; color: var(--text-secondary); margin-bottom: 0.75rem;">
                  <div style="padding: 0.5rem; background: var(--bg-page); border-radius: 0.25rem; border: 2px solid rgba(66, 133, 244, 0.5);">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='60'%3E%3Crect fill='%23e5e7eb' width='100' height='60'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='12' fill='%236b7280'%3EImage%3C/text%3E%3C/svg%3E" alt="Selected image" style="display: block; max-width: 100%; height: auto;" />
                  </div>
                </div>
                <div style="font-size: 0.75rem; color: var(--text-muted);">
                  <div><strong>Container:</strong> Element node (IMG, DIV, etc.)</div>
                  <div><strong>Offset:</strong> Child index (0, 1, 2...)</div>
                  <div><strong>Example:</strong> startOffset: 0, endOffset: 1</div>
                </div>
              </div>
            </div>

            <div style="margin-top: 1rem; padding: 1rem; background: var(--bg-surface); border-radius: 0.375rem; border: 1px solid var(--border-light);">
              <h4 style="font-size: 0.9rem; margin: 0 0 0.75rem 0; color: var(--text-primary); font-weight: 600;">
                Visual Comparison
              </h4>
              <div style="font-size: 0.85rem; line-height: 1.8; color: var(--text-secondary);">
                <div style="margin-bottom: 0.5rem;">
                  <strong style="color: var(--text-primary);">Text Selection:</strong> Highlights characters within a text node. The selection appears as a colored background over the selected text.
                </div>
                <div>
                  <strong style="color: var(--text-primary);">Node Selection:</strong> Selects the entire element. Visual representation varies by browser - some show borders, some show background, some may not show any visual indication.
                </div>
              </div>
            </div>
          </div>

          <div style="margin: 1.5rem 0; padding: 1rem; background: #fff3cd; border: 1px solid #ffc107; border-radius: 0.5rem;">
            <p style="margin: 0; font-size: 0.9rem; color: #856404;">
              <strong>Important:</strong> You cannot create a selection using just a node object. You must use the <code style="background: rgba(255, 255, 255, 0.5); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.85em;">Range</code> API to define the selection boundaries, then apply it to the <code style="background: rgba(255, 255, 255, 0.5); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.85em;">Selection</code> object. A node alone is not enough - you need to create a Range that encompasses the node.
            </p>
          </div>
          
          <div style="margin: 1.5rem 0; padding: 1rem; background: #fff3cd; border: 1px solid #ffc107; border-radius: 0.5rem;">
            <p style="margin: 0; font-size: 0.9rem; color: #856404;">
              <strong>⚠️ Important:</strong> You cannot create a selection using just a node object. A node by itself is not selectable - you must use the <code style="background: rgba(255, 255, 255, 0.5); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.85em;">Range</code> API to define selection boundaries, then apply it to the <code style="background: rgba(255, 255, 255, 0.5); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.85em;">Selection</code> object. The Range acts as a bridge between the node and the selection.
            </p>
          </div>

          <h3
            style="
              font-size: 1.1rem;
              margin: 1.5rem 0 0.75rem 0;
              color: var(--text-primary);
            "
          >
            Selecting Entire Nodes
          </h3>
          <p style="margin: 0 0 1rem 0;">
            Use <code style="background: var(--bg-muted); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.85em;">range.selectNode(node)</code> to select an entire element node, including the element itself. This requires creating a Range first:
          </p>
          <pre
            style="
              background: var(--bg-muted);
              border: 1px solid var(--border-light);
              border-radius: 0.5rem;
              padding: 1rem;
              overflow-x: auto;
              font-size: 0.85rem;
              line-height: 1.6;
              color: var(--text-primary);
            "
          ><code>{nodeSelectionCode}</code></pre>

          <h3
            style="
              font-size: 1.1rem;
              margin: 1.5rem 0 0.75rem 0;
              color: var(--text-primary);
            "
          >
            Key Differences from Text Selection
          </h3>
          <ul style="margin: 0 0 1rem 0; padding-left: 1.5rem;">
            <li style="margin-bottom: 0.5rem;">
              <strong>Container type:</strong> In node selection, <code style="background: var(--bg-muted); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.85em;">startContainer</code> and <code style="background: var(--bg-muted); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.85em;">endContainer</code> are element nodes, not text nodes.
            </li>
            <li style="margin-bottom: 0.5rem;">
              <strong>Offset meaning:</strong> When the container is an element node, <code style="background: var(--bg-muted); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.85em;">startOffset</code> and <code style="background: var(--bg-muted); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.85em;">endOffset</code> represent child node indices (0, 1, 2...), not character positions.
            </li>
            <li style="margin-bottom: 0.5rem;">
              <strong>Visual appearance:</strong> Node selections may appear differently across browsers. Some browsers show a border or outline around selected elements, while others may not visually distinguish node selections from text selections.
            </li>
            <li style="margin-bottom: 0.5rem;">
              <strong>Common use cases:</strong> Selecting images, selecting entire paragraphs or blocks, programmatically selecting content for clipboard operations.
            </li>
          </ul>

          <div style="margin-top: 1.5rem; padding: 1rem; background: var(--bg-surface); border-radius: 0.5rem; border: 1px solid var(--border-light);">
            <h4 style="font-size: 0.95rem; margin: 0 0 0.75rem 0; color: var(--text-primary);">
              Why Range is Required
            </h4>
            <p style="margin: 0 0 0.75rem 0; font-size: 0.9rem; color: var(--text-secondary);">
              A node object alone cannot be directly selected. The Selection API requires a Range object that defines the boundaries of what to select. Here's the process:
            </p>
            <ol style="margin: 0 0 0.75rem 0; padding-left: 1.5rem; font-size: 0.9rem; color: var(--text-secondary);">
              <li style="margin-bottom: 0.5rem;">
                <strong>Get the node:</strong> <code style="background: var(--bg-muted); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.85em;">const node = document.getElementById('myImage');</code>
              </li>
              <li style="margin-bottom: 0.5rem;">
                <strong>Create a Range:</strong> <code style="background: var(--bg-muted); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.85em;">const range = document.createRange();</code>
              </li>
              <li style="margin-bottom: 0.5rem;">
                <strong>Select the node with Range:</strong> <code style="background: var(--bg-muted); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.85em;">range.selectNode(node);</code>
              </li>
              <li style="margin-bottom: 0.5rem;">
                <strong>Apply Range to Selection:</strong> <code style="background: var(--bg-muted); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.85em;">selection.addRange(range);</code>
              </li>
            </ol>
            <p style="margin: 0.75rem 0 0 0; font-size: 0.85rem; color: var(--text-muted);">
              Without the Range step, you cannot select a node. The Range object is the mechanism that tells the browser "select this node" or "select from this position to that position."
            </p>
          </div>

          <div style="margin-top: 1.5rem; padding: 1rem; background: var(--bg-muted); border-radius: 0.5rem; border: 1px solid var(--border-light);">
            <h4 style="font-size: 0.95rem; margin: 0 0 0.75rem 0; color: var(--text-primary);">
              Example: Detecting Node Selection
            </h4>
            <pre
              style="
                background: var(--bg-surface);
                border: 1px solid var(--border-light);
                border-radius: 0.375rem;
                padding: 0.75rem;
                overflow-x: auto;
                font-size: 0.85rem;
                line-height: 1.6;
                color: var(--text-primary);
                margin: 0;
              "
            ><code>{`const selection = window.getSelection();
if (selection && selection.rangeCount > 0) {
  const range = selection.getRangeAt(0);
  
  // Check if selection is a node selection
  const isNodeSelection = 
    range.startContainer.nodeType === Node.ELEMENT_NODE ||
    range.endContainer.nodeType === Node.ELEMENT_NODE;
  
  if (isNodeSelection) {
    console.log('Node selection detected');
    console.log('Selected node:', range.startContainer);
    console.log('Child index:', range.startOffset);
  }
}`}</code></pre>
          </div>

          <div style="margin-top: 1.5rem; padding: 1rem; background: var(--bg-muted); border-radius: 0.5rem; border: 1px solid var(--border-light);">
            <h4 style="font-size: 0.95rem; margin: 0 0 0.75rem 0; color: var(--text-primary);">
              Important Notes
            </h4>
            <ul style="margin: 0; padding-left: 1.5rem; font-size: 0.9rem;">
              <li style="margin-bottom: 0.5rem;">
                Node selection is less common in user interactions compared to text selection. Most users select text, not entire elements.
              </li>
              <li style="margin-bottom: 0.5rem;">
                When <code style="background: var(--bg-surface); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.85em;">startContainer</code> is an element node, <code style="background: var(--bg-surface); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.85em;">startOffset</code> refers to the index of the child node, not a character position.
              </li>
              <li style="margin-bottom: 0.5rem;">
                <code style="background: var(--bg-surface); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.85em;">range.toString()</code> on a node selection returns the text content of all descendant text nodes, which may not represent the actual selected element.
              </li>
              <li style="margin-bottom: 0.5rem;">
                Some browsers handle node selection differently in contenteditable regions, especially for inline elements like images or links.
              </li>
            </ul>
          </div>
        </section>

        <section style="margin-bottom: 2rem;">
          <h2
            style="
              font-size: 1.3rem;
              margin: 0 0 0.75rem 0;
              padding-bottom: 0.5rem;
              border-bottom: 2px solid var(--border-light);
            "
          >
            Native Selection Visualization
          </h2>
          <p style="margin: 0 0 1rem 0;">
            Browsers render text selections using their native styling. The visual appearance of selections varies by browser and operating system. Try selecting text in the contenteditable area below to see how your browser displays selections:
          </p>
          
          <div
            style="
              background: var(--bg-surface);
              border: 2px solid var(--border-medium);
              border-radius: 0.5rem;
              padding: 1.5rem;
              margin: 1rem 0;
            "
          >
            <div
              contenteditable="true"
              id="selection-demo"
              style="
                min-height: 120px;
                padding: 1rem;
                background: var(--bg-page);
                border: 1px solid var(--border-light);
                border-radius: 0.375rem;
                outline: none;
                font-size: 1rem;
                line-height: 1.6;
              "
            >
              <p>This is a <strong>contenteditable</strong> paragraph with <em>various</em> inline elements.</p>
              <p>Select some text above to see how your browser renders the native selection. The selection appearance depends on your browser and operating system.</p>
              <p>You can also select across multiple paragraphs and elements to observe how the selection behaves at element boundaries.</p>
            </div>
            
            <div
              id="selection-info"
              style="
                margin-top: 1rem;
                padding: 0.75rem;
                background: var(--bg-muted);
                border: 1px solid var(--border-light);
                border-radius: 0.375rem;
                font-size: 0.85rem;
                font-family: var(--font-mono);
                color: var(--text-secondary);
              "
            >
              <div style="margin-bottom: 0.5rem;"><strong>Selection Info:</strong></div>
              <div id="selection-details" style="color: var(--text-primary);">No selection</div>
            </div>
          </div>

          <div style="margin-top: 1.5rem; padding: 1rem; background: var(--bg-muted); border-radius: 0.5rem; border: 1px solid var(--border-light);">
            <h3 style="font-size: 1rem; margin: 0 0 0.75rem 0; color: var(--text-primary);">
              Browser Selection Styles
            </h3>
            <p style="margin: 0 0 0.75rem 0; font-size: 0.9rem;">
              Different browsers and operating systems use different default selection colors:
            </p>
            <ul style="margin: 0; padding-left: 1.5rem; font-size: 0.9rem;">
              <li style="margin-bottom: 0.5rem;">
                <strong>Chrome/Edge (Windows):</strong> Blue background (#4285f4)
              </li>
              <li style="margin-bottom: 0.5rem;">
                <strong>Firefox (Windows):</strong> Blue background (#0060df)
              </li>
              <li style="margin-bottom: 0.5rem;">
                <strong>Safari (macOS):</strong> Light blue background (#007aff)
              </li>
              <li style="margin-bottom: 0.5rem;">
                <strong>Chrome (macOS):</strong> Light blue background (#007aff)
              </li>
              <li style="margin-bottom: 0.5rem;">
                <strong>Mobile browsers:</strong> Varies by platform, often uses system accent color
              </li>
            </ul>
            <p style="margin: 0.75rem 0 0 0; font-size: 0.85rem; color: var(--text-muted);">
              Note: The selection color can be customized using CSS <code style="background: var(--bg-surface); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.85em;">::selection</code> pseudo-element, but the default browser behavior is what users see by default.
            </p>
          </div>
        </section>

        <section style="margin-bottom: 2rem;">
          <h2
            style="
              font-size: 1.3rem;
              margin: 0 0 0.75rem 0;
              padding-bottom: 0.5rem;
              border-bottom: 2px solid var(--border-light);
            "
          >
            Common issues
          </h2>
          <div style="margin-bottom: 1.5rem;">
            <h3
              style="
                font-size: 1.1rem;
                margin: 0 0 0.5rem 0;
                color: var(--text-primary);
              "
            >
              Selection lost on focus change
            </h3>
            <p style="margin: 0 0 0.5rem 0;">
              When a contenteditable loses focus, <code style="background: var(--bg-muted); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.85em;">window.getSelection()</code> may return <code style="background: var(--bg-muted); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.85em;">null</code> or an empty selection, making it difficult to preserve selection state.
            </p>
            <p style="margin: 0; font-size: 0.85rem; color: var(--text-muted);">
              See cases: <a href="/scenarios/scenario-selection-api-behavior" style="color: var(--accent-primary);">scenario-selection-api-behavior</a>
            </p>
          </div>

          <div style="margin-bottom: 1.5rem;">
            <h3
              style="
                font-size: 1.1rem;
                margin: 0 0 0.5rem 0;
                color: var(--text-primary);
              "
            >
              Incorrect range boundaries
            </h3>
            <p style="margin: 0 0 0.5rem 0;">
              When selecting text that spans multiple elements, the Range boundaries may not accurately reflect the visual selection, especially across element boundaries.
            </p>
            <p style="margin: 0; font-size: 0.85rem; color: var(--text-muted);">
              See cases: <a href="/scenarios/scenario-selection-range-accuracy" style="color: var(--accent-primary);">scenario-selection-range-accuracy</a>
            </p>
          </div>

          <div>
            <h3
              style="
                font-size: 1.1rem;
                margin: 0 0 0.5rem 0;
                color: var(--text-primary);
              "
            >
              Selection collapse on blur
            </h3>
            <p style="margin: 0 0 0.5rem 0;">
              Clicking outside a contenteditable may collapse the selection unexpectedly, even when the click target is within the same document.
            </p>
            <p style="margin: 0; font-size: 0.85rem; color: var(--text-muted);">
              See cases: <a href="/scenarios/scenario-selection-collapse-on-blur" style="color: var(--accent-primary);">scenario-selection-collapse-on-blur</a>
            </p>
          </div>
        </section>

        <section>
          <h2
            style="
              font-size: 1.3rem;
              margin: 0 0 0.75rem 0;
              padding-bottom: 0.5rem;
              border-bottom: 2px solid var(--border-light);
            "
          >
            Related resources
          </h2>
          <ul style="margin: 0; padding-left: 1.5rem;">
            <li style="margin-bottom: 0.5rem;">
              <a
                href="/cases?tag=selection"
                style="color: var(--accent-primary); text-decoration: none;"
              >
                Browse selection-related cases →
              </a>
            </li>
            <li style="margin-bottom: 0.5rem;">
              <a
                href="https://developer.mozilla.org/en-US/docs/Web/API/Selection"
                target="_blank"
                rel="noopener noreferrer"
                style="color: var(--accent-primary); text-decoration: none;"
              >
                MDN: Selection API (external) →
              </a>
            </li>
          </ul>
        </section>
      </article>
      </section>
    </main>

    <script>
      // Selection visualization script
      const demoEl = document.getElementById('selection-demo');
      const infoEl = document.getElementById('selection-info');
      const detailsEl = document.getElementById('selection-details');

      function updateSelectionInfo() {
        const selection = window.getSelection();
        
        if (!selection || selection.rangeCount === 0 || selection.isCollapsed) {
          detailsEl.textContent = 'No selection';
          return;
        }

        const range = selection.getRangeAt(0);
        const selectedText = range.toString();
        
        const info = {
          text: selectedText.length > 50 ? selectedText.substring(0, 50) + '...' : selectedText,
          length: selectedText.length,
          startContainer: range.startContainer.nodeName === '#text' 
            ? `#text (parent: ${range.startContainer.parentElement?.tagName || 'none'})`
            : range.startContainer.nodeName,
          endContainer: range.endContainer.nodeName === '#text'
            ? `#text (parent: ${range.endContainer.parentElement?.tagName || 'none'})`
            : range.endContainer.nodeName,
          startOffset: range.startOffset,
          endOffset: range.endOffset,
          collapsed: range.collapsed,
          commonAncestor: range.commonAncestorContainer.nodeName === '#text'
            ? `#text (parent: ${range.commonAncestorContainer.parentElement?.tagName || 'none'})`
            : range.commonAncestorContainer.nodeName,
        };

        detailsEl.innerHTML = `
          <div style="margin-bottom: 0.25rem;"><strong>Text:</strong> "${info.text}" (${info.length} chars)</div>
          <div style="margin-bottom: 0.25rem;"><strong>Start:</strong> ${info.startContainer} @ ${info.startOffset}</div>
          <div style="margin-bottom: 0.25rem;"><strong>End:</strong> ${info.endContainer} @ ${info.endOffset}</div>
          <div style="margin-bottom: 0.25rem;"><strong>Common Ancestor:</strong> ${info.commonAncestor}</div>
          <div><strong>Collapsed:</strong> ${info.collapsed ? 'Yes' : 'No'}</div>
        `;
      }

      // Update on selection change
      document.addEventListener('selectionchange', updateSelectionInfo);
      
      // Also update on mouse/keyboard events in the demo area
      if (demoEl) {
        demoEl.addEventListener('mouseup', updateSelectionInfo);
        demoEl.addEventListener('keyup', updateSelectionInfo);
        demoEl.addEventListener('focus', () => {
          setTimeout(updateSelectionInfo, 0);
        });
      }
    </script>
  </body>
</html>

